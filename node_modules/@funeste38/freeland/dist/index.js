"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerSystem = registerSystem;
exports.decodeSystemValue = decodeSystemValue;
const registry = new Map();
function registerSystem(prefix, decoder) {
    registry.set(prefix, decoder);
}
async function decodeSystemValue(raw) {
    for (const [prefix, decoder] of registry) {
        if (raw.startsWith(prefix)) {
            const tail = raw.slice(prefix.length);
            const res = decoder(tail);
            return res instanceof Promise ? await res : res;
        }
    }
    // fallback: return raw
    return raw;
}
// built-ins
registerSystem('json:', (s) => JSON.parse(s));
registerSystem('b64:', (s) => Buffer.from(s, 'base64').toString('utf8'));
registerSystem('file:', (s) => {
    // simple sync read
    const fs = require('fs');
    const path = require('path');
    const p = path.resolve(s);
    return fs.readFileSync(p, 'utf8');
});
registerSystem('nez:', (s) => `nez:${s}`);
