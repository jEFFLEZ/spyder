const { encodeToOC8Png, decodeFromOC8Png } = require('../src/oc8.cjs');
const { scramblePngBlocks, unscramblePngBlocks } = require('../src/rubik.cjs');
const assert = require('assert');

const payload = Buffer.from('this is a secret payload');
const png = encodeToOC8Png(payload, 16, 16);
const key = 'NOSSEN-ALPHA-ONZE-2025';
const scrambled = scramblePngBlocks(png, key, 4);
const descrambled = unscramblePngBlocks(scrambled, key, 4);
const out = decodeFromOC8Png(descrambled);
assert.strictEqual(out.toString('utf8'), payload.toString('utf8'));
console.log('rubik roundtrip ok');
